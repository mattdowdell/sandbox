# TODO: move to separate repository

name: 'Go Install'
description: 'Installs and caches Go binaries using "go install".'

inputs:
  name:
    description: 'The name of the Go binary to install.'
    required: true
  package:
    description: 'The Go package to install'
    required: true
  version:
    description: 'The Go package version to install.'
    required: false
    default: 'latest'

outputs:
  version:
    description: 'The installed version.'
    value: ${{ steps.version.outputs.version }}
  cached:
    description: 'Whether the binary was cached.'
    value: ${{ steps.cache.outputs.cache-hit }}

runs:
  using: "composite"
  steps:
    - name: Version
      id: version
      uses: actions/github-script@v7
      with:
        script: |
          const script = require('./version.js')
          await script({core, exec})
      env:
        package: ${{ inputs.package }}
        version: ${{ inputs.version }}

    - name: Cache
      uses: actions/cache@v4
      id: cache
      with:
        path: ~/go/bin/${{ inputs.name }}
        key: go-install-${{ runner.os }}-${{ runner.arch }}-${{ inputs.name }}-${{ steps.version.outputs.version }}-${{ hashFiles('~/go/bin/${{ inputs.name }}') }}
        restore-keys: go-install-${{ runner.os }}-${{ runner.arch }}-${{ inputs.name }}-${{ steps.version.outputs.version }}-

    - name: Install
      uses: actions/github-script@v7
      with:
        script: |
          const script = require('./install.js')
          await script({exec})
      env:
        package: ${{ inputs.package }}
        version: ${{ steps.version.outputs.version }}
